# 第二章 简单的 HTTP 协议

## HTTP 协议用于客户端和服务端之间的通信

* 请求访问文本或图像等资源的一端称之为客户端，而提供资源响应的一方称之为服务器端
  > 客户端的定义在上一章节中也有指出

* 在两台计算机之间使用 HTTP 协议通信时，在一条通信线路上必定有一端是客户端，另一端则是服务器端。
  ![客户端 && 服务端](https://xhh-image-1258151134.cos.ap-nanjing.myqcloud.com/Markdown%20image/%E5%AE%A2%E6%88%B7%E7%AB%AF%20%26%26%20%E6%9C%8D%E5%8A%A1%E7%AB%AF.png)

## 通过请求和响应的交换达成通信

* HTTP 协议规定，请求从客户端发出，最后服务器响应该请求并返回。换句话说，**肯定是从客户端开始建立通信的，服务端在没有接收到请求之前不会发送响应。**

* **请求报文是由请求方法、请求 URI、协议版本、可选的请求首部字段和内容实体构成。**

* **响应报文基本上由协议版本、状态码（表示请求成功或失败的数字代码）、泳衣解释状态码的原因短语、可选的响应首部字段以及实体主体构成。**

## HTTP 是不保存状态的协议

* HTTP 是一种不保存状态，即无状态（stateless）协议。HTTP 协议自身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个级别，**协议对于发送过的请求或响应都不做持久化处理**。

* 使用 HTTP 协议，每当**有新的请求发送时，就会有对应的新响应产生。协议本身并不保留之前一切的请求或响应报文的信息**。这是为了**更快地处理大量事务，确保协议的可伸缩性**，而特意把 HTTP 协议设计成如此简单。

## 请求 URI 定位资源

* HTTP 协议使用 URI 定位互联网上的资源。
  > 关于 URI 在上一章节中也有解释

* 当客户端请求访问资源而发送请求时，URI 需要作为请求报文中的请求 URI 包含在内。如果不是访问特定资源而是对服务器本身发起请求，可以用 `*` 来代替请求 URI。

## 告知服务器意图的 HTTP 方法

### GET - 获取资源

### POST - 传输实体主体

### PUT - 传输文件

### HEAD - 获取报文首部

### DELETE - 删除文件

### OPTIONS - 询问支持方法

### TRACE - 追踪路径

### CONNECT - 要求使用隧道协议连接代理

## 使用方法下达命令

* 向请求 URI 指定的资源发送请求报文时，采用成为方法的命令。方法的作用在于，可以指定请求的资源按期望产生某种行为。
  > 具体 HTTP 协议有哪些方法，在上一小节已经有提出了。

HTTP 协议通信方法表：
|  方法   |           说明           | 支持的HTTP协议版本 |
| :-----: | :----------------------: | :----------------- |
|   GET   |         传输资源         | 1.0、1.1           |
|  POST   |       传输实体主体       | 1.0、1.1           |
|   PUT   |         传输文件         | 1.0、1.1           |
|  HEAD   |       获取报文首部       | 1.0、1.1           |
| DELETE  |         删除文件         | 1.0、1.1           |
| OPTIONS |       询问支持方法       | 1.0、1.1           |
|  TRACE  |         追踪路径         | 1.1                |
| CONNECT | 要求使用隧道协议连接代理 | 1.1                |
|  LINK   |   建立和资源之间的联系   | 1.0（废除）        |
| UNLINK  |       断开连接关系       | 1.0（废除）        |

## 持久连接节省通信量

* 在 HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接。也就是说客户端与服务器端的每次通信，客户端发起的每次请求都会造成无谓的 TCP 连接建立和断开，这样也增加通信量的开销。

### 持久连接

* 为了 TCP 连接的问题，HTTP/1.1 和一部分的 HTTP/1.0 想出了持久连接（HTTP Persistent Connections，也成为 HTTP keep-alive 或 HTTP connection reuse）的方法。持久连接的特点是：**只要任意一段没有明确提出断开连接，则保持 TCP 连接状态**。

  #### 持久连接优点

  * 减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载
  * 减少开销的那部分事件，是 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相应的提高了

* **在 HTTP/1.1 中，所有的连接默认都是持久连接，但在 HTTP/1.0 内未标准化。**

### 管线化

* 持久连接使得多数请求译管线化（pipelining）方式发送成为可能。从前**客户端发送请求后需等待并受到服务器端的响应，才能发送下一个请求**。管线化技术出现后，**不需要等待服务器端响应即可直接发送下一个请求**。

* 与一个一个连接相比，用持久连接可以让请求更快结束。而管线化技术则比持久连接还要快。**请求数越多，时间差越明显**。

## 使用 Cookie 的状态管理

* HTTP 是无状态协议，它不对之前发生过的请求和响应的状态进行管理。也就是说无法根据之前的状态进行本次的请求处理。

* 不可否认，无状态协议当然也有它的有点。由于不必保存状态，自然可减少服务器的 CPU 及内存资源的消耗。从另一方面来说，也正是应为 HTTP 协议本身是非常简单的，所以才会被应用在各种场景。

* Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。

* Cookie 会根据从服务器端发送的响应报文内的一个叫做 `Set-Cookie` 的首部字段信息，通知客户端保存 Cookie。当下次客户端在往服务器端发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。

## 扩展阅读

## TODO
- [ ] HTTP 方法内容补齐

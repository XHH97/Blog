b# 了解 Web 及网络基础

## 使用 HTTP 协议访问 Web

* 通常我们将发送请求获取服务端数据的 Web 浏览器，APP等称之为**客户端（Client）**
  > 请求: 是通过指定的 URL 地址获取（发送）服务器上的数据

* Web 使用一种名为 HTTP （HypeText Transfer Protocol, 超文本传输协议）的协议作为规范，完成从客户端到服务器端等一系列运作流程。**而协议是指规则的约定**。我们也可以说 **Web 是建立在 HTTP 协议上进行通信的**。

## HTTP 的诞生

### 为知识共享而规划 Web

* Web 最初设想理念：借助多文档之间相互关联形成的超文本（HypeText），连成可相互参阅的 WWW（Word Wide Web - 万维网）。
    > 该设想最初提出者是互联网之父 --- 蒂姆·伯纳斯·李

* 现代 WWW 以提出3项 WWW 构建技术:
  * 将 [SGML](#扩展阅读)（Standard Generalized Markup Language - 标准通用标记语言）作为页面的文本标记语言 HTML（HypeText Markup Language - 超文本标记语言）
  * URL（Uniform Resource Locator - 统一资源标识符）指定文档所在地址
  * HTTP 作为文档的传递协议

**HTTP 发展时间线**：
| 版本     | 发布时间 |                                       主要内容                                       |                                                                                         备注                                                                                         |
| :------- | :------: | :----------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
| HTTP/0.9 |  1990年  |          只接受 GET 一种请求方法，没有在通讯中指定版本号，且不支持请求头。           |                                                              由于这个时候 HTTP 刚诞生，所以该版本并不是 HTTP 的正式标准                                                              |
| HTTP/1.0 | 1996.05  |                                          -                                           |                                                                   HTTP 协议的正式标准，也是现在广泛使用的一个版本                                                                    |
| HTTP/1.1 | 1997.01  | 在该版本中采用了持久连接并默认开启，支持以管道化的方式同时发送多个请求，提高传输速率 | 该本是目前最主流使用的 HTTP 版本，且较于 HTTP/1.0 的优势主要体现在: **缓存处理、带宽优化及网络连接的使用、错误消息通知管理、消息在网络中的发送、互联网地址的维护以及安全性和完整性** |
| HTTP/2.0 |   2015   |                                          -                                           |                                                                                          -                                                                                           |
| HTTP/3.0 |   2018   |                                          -                                           |                                                                                          -                                                                                           |

## 网络基础 TCP/IP

* 通常我们使用的网络（包括互联网）是在TCP/IP协议族的基础上运作的。而 HTTP 是属于它内部的一个子集。

### TCP/IP 协议族

* 计算机与网络设备要相互通信，双方就必须基于相同的方法。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为协议（ protocol）。
  
* 把与互联网相关联的协议集合起来总称为 TCP/IP。也有说法认为， TCP/IP 是指 TCP 和 IP 这两种协议。还有一种说法认为， TCP/IP 是在 IP 协议的通信过程中，使用到的协议族的统称。
  > 互联网协议套件是一个网络通信模型，以及一整个网络传输协议家族，为网际网络的基础通信架构。它常被统称为TCP/IP协议族，简称为TCP/IP。
  > 因为该协议家族的两个核心协议：TCP(传输控制协议)和IP(网际协议)，为该家族中最早通过的标准。
  > 由于在网络通讯协议普遍采用分层的结构，当多个层次的协议共同工作时，类似计算机科学中的堆栈，因此又被称为TCP/IP协议栈。[扩展阅读](#扩展阅读)

  **笔记**：
  TCP/IP协议族具体包含的协议：
  [扩展阅读](#扩展阅读)
  | 分层                 |                                                                     协议                                                                     | 备注                                                                                                                                                                                                                                                                                                                                                                                                                                    |
  | :------------------- | :------------------------------------------------------------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | 应用层               | HTTP（超文本传输协议）、HTTPS（超文本传输安全协议）、DNS（域名管理系统），FTP（文件传输协议）、SMTP（简单邮件传输协议）、SSH（安全外壳协议） | 应用层直接和应用程序接口结合，并提供常见的网络应用服务</br>应用层决定了向用户提供应用服务时通信的活动。                                                                                                                                                                                                                                                                                                                                 |
  | 传输层               |                                TCP（传输控制协议）、UDP（用户数据报协议）、SSL/TSL（传输层安全协议/安全套接层）                                | 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输</br>为应用进程提供端到端的通信服务。 它提供面向连接的数据流支持、可靠性、流量控制、多路复用等服务。                                                                                                                                                                                                                                                                    |
  | 网络层（IP 层）               |                                                         IP（IPv4、IPv6, - 网际协议）                                                         | 提供路由和寻址的功能，使两终端系统能够互连且决定最佳路径，并具有一定的拥塞控制和流量控制的能力。相当于发送邮件时需要地址一般重要。由于TCP/IP协议体系中的网络层功能由IP协议规定和实现，故又称IP层。</br>网络层用来处理来自网络上流动的数据包，该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项中选择一条传输路线。 |
  | 链接层（数据链路层） |                                                        以太网，IEEE 802.11 WiFi 标准                                                         | 数据链路层用来处理连接网络的硬件部分，包括控制操作系统、硬件的设备驱动、NIC（网络适配器-网卡）以及光纤等物理可见部分（还包括连接器等一切传输媒介），硬件上的范畴均在链路层的作用范围之内。                                                                                                                                                                                                                                              |

  *该表格使用的网络分成模式是 TCP/IP 协议族四层模型*

### TCP/IP 的分层管理

* TCP/IP 协议族中最重要的一点就是分层。TCP/IP 协议族按层次分别分为以下4层：应用层，传输层，网络层，数据链路层。
    > OSI 七层模型: 应用层，会话层，表示层，传输层，网络层，数据链路层，物理层
    > TCP/IP 五层模型: 应用层，传输层，网络层，数据链路层，物理层
  * 网络模型各层的简介（TCP/IP 协议族四层模型）
    * 应用层
      * 应用层决定了向用户提供应用服务时通信的活动
      * TCP/IP协议族内预存了各类通用的服务。比如，FTP（文件传输协议）和DNS（域名系统）服务就是其中的两类。**HTTP 协议也在改层**。SMTP（邮件传输协议）、SSH（安全外壳协议 - 网络传输协议）
    * 传输层
      * 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输
      * 在传输层有两个性质不同协议，TCP（传输控制协议）和 UDP（用户数据报协议）。e.g：SSL/TSL（两种安全协议，传输层安全协议，安全套接层）
    * 网络层
      * 网络层用来处理来自网络上流动的数据包，**数据包是网络传输的最小单位**
      * 该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项中选择一条传输路线。
      * **IP协议处于该层**
    * 数据链路层
      * 数据链路层用来处理连接网络的硬件部分，包括控制操作系统、硬件的设备驱动、NIC（网络适配器-网卡）以及光纤等物理可见部分（还包括连接器等一切传输媒介），硬件上的范畴均在链路层的作用范围之内。
      * 这里就有我们熟悉的**以太网**，**IEEE 802.11 WiFi 标准**。

### TCP/IP 协议族的分层管理优势

* 如果互联网中只有一个协议统筹，那么需要更换其中一个环节，就需要将整个部分全部进行跟换。而采用分层管理，就只是需要将需要变动的部分就行更换，而不需要进行整体部分的变动。这样使得在设计上变得更加的自由，每一个层次只需要知道自己需要去完成什么就可以了，不用去设计其他层级的事情。

### TCP/IP 通信流

* 利用TCP/IP协议族进行网络通信时，会通过分层顺序与对方进行通信，**发送端从应用层向下走，接收端则从两路层往上走**，发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层之间传输数据时，每经过一层会把对应的首部消去，**这种把数据信息包装起来的做法称为封装（encapsulate）**。

  *TCP/IP 通信流图例*
  ![TCP/IP 通信流](https://xhh-image-1258151134.cos.ap-nanjing.myqcloud.com/Markdown%20image/%E5%9B%BE%E8%A7%A3%20HTTP/%E7%AC%AC%E4%B8%80%E7%AB%A0/TCP%26IP%20%E9%80%9A%E4%BF%A1%E6%B5%81.png)

## 与 HTTP 关系密切的协议：IP、**TCP** 和 DNS

### 负责传输的 IP 协议

* 按层次分，IP（网际协议）协议位于网络层，在互联网中几乎所有使用到网络的系统都会使用到 IP 协议。

* IP协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要条件就是 IP 地址和 MAC 地址。
  * IP 地址：指明了节点被分配到的地址
  * MAC 地址：指网卡所属的固定地址
* IP 地址可以和 MAC 地址进行配对。且 IP 地址是可以进行更换的，但 MAC 地址基本上是不会更换。

#### 使用ARP（地址解析协议）协议凭借MAC地址进行通信

* IP 间的通信依赖 MAC 地址，在实际的网络环境中，局域网环境是很少的，通常我们都需要中转多台设备（路由）才能够到达目的客户端，而在进行中转时，会利用下一个中转设备（路由）去搜索下一个中转目标。在进行中转时就会使用到 ARP 协议。
    > 在正常的网络通信时，我们通常需要进过多台计算机或是网络设备才能够到达目的地址，而在其他计算机或是网络设备中转时则会采用ARP协议根据通信方的IP地址反向查找出对应的MAC地址。

* APR协议是一种用以解析地址的协议，根据通信方的IP地址就可以反向查出对应的MAC地址。

#### 没有人能够全面掌握互联网中的传输情况

* 在到达通信目标前的中转过程中，那些计算机和路由器等网络设备只能够获取初略的传输路线。这种在网络数据传输过程中选择传输路线的机制称之为路由选择（routing）

### 确保可靠性的 TCP 协议

* 按层次分，TCP 协议位于传输层，提供可靠的字节流服务，**所谓的字节流服务（Byte Stream Service）是指：为了方便传输将大块数据分割成以报文段（segment）为单位的数据包进行管理；而可靠的传输服务是指：能够将数据准确可靠地传送给对方，确保数据能够到达目标。**
    > TCP协议为了更容易传送大数据才把数据分割，而TCP协议能够确认数据最终是否传送到达对方

* 在 TCP 协议中确保数据传输的可靠性采用了三次握手（three-way handshaking）策略。握手过程中使用了 TCP 标志（flag）--- SYN（synchronize） 和 ACK（acknowledgement），**握手过程中摸个阶段莫名中断，TCP协议会再次一相同的顺序发送相同的数据包**。
    > 断开连接是则会将 SYN 变成 FIN，也就是说会先发送 FIN，然后服务端返回 FIN/ACK，客户端再返回 ACK，然后服务端再发送一个 FIN 给客户端。

### 负责域名解析的 DNS 服务

* 按层次分，DNS（域名管理系统）服务位于应用层中与HTTP协议于同一层。**DNS（域名管理系统）服务提供域名到IP地址之间的解析服务，也就是通过域名查找IP地址，或逆向从IP地址反向查找域**名。计算机可以被赋予IP地址，也可以被赋予主机名和域名。
    > 其实我们的电脑就是一个 DNS 服务器。

* DNS服务运行的基本流程图

## 各种协议与 HTTP 协议的关系

**各种协议与 HTTP 协议的关系图示**：
![各种协议与 HTTP 协议的关系](https://xhh-image-1258151134.cos.ap-nanjing.myqcloud.com/Markdown%20image/%E5%9B%BE%E8%A7%A3%20HTTP/%E7%AC%AC%E4%B8%80%E7%AB%A0/%E5%90%84%E7%A7%8D%E5%8D%8F%E8%AE%AE%E4%B8%8E%20HTTP%20%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB.png)

## URI 和 URL

* 与 URI 相比我们更加的熟悉 URL。URL 正是我们使用浏览器等客户端访问 Web 页面时需要输入的网页地址。

* URI 用字符串标识某一互联网资源，而 URL 标识资源的地点（互联网）。可见 URL 是 URI 的子集。

## 扩展阅读

* [SGML](https://zh.wikipedia.org/zh-hans/SGML)
* [关于 TCP/IP 协议族](https://zh.wikipedia.org/wiki/TCP/IP%E5%8D%8F%E8%AE%AE%E6%97%8F)
* [RFC1945 - Hypertext Transfer Protocol -- HTTP/1.0](http://www.ietf.org/rfc/rfc1945.txt)
* [RFC2616 - Hypertext Transfer Protocol -- HTTP/1.1](http://www.ietf.org/rfc/rfc2616.txt)
* [路由](https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1)

## TODO

* [ ] 补充 HTTP 发展时间线表格内容
* [ ] 路由选择的扩展阅读（路由寻址？）
* [ ] URL 和 URI 的区别是什么
* [ ] TCP 三次握手和四次握手策略

# 第四章：返回结果的 HTTP 状态码

## 状态码告知从服务器端返回的请求结果

* 状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果。借助状态码，用户可以知道服务器端是正常处理了请求，还是出现了错误。

**HTTP 协议中的状态码类别表**：
|      | 类别                             | 原因短语                   |
| :--- | :------------------------------- | :------------------------- |
| 1XX  | Informational（信息性状态码）    | 接收的请求正在处理         |
| 2XX  | Success（成功状态码）            | 请求正常处理完毕           |
| 3XX  | Redirection（重定向状态码）      | 需要进行附加操作已完成操作 |
| 4XX  | Client Error（客户端错误状态）   | 服务器无法处理请求         |
| 5XX  | Server Error（服务器错误状态码） | 服务器处理请求出错         |

* 仅记录在 RFC2616 上的 HTTP 状态码就达 **40** 种，若再加上WebDAV（ Web-based Distributed Authoring and Versioning，基于万维网的分布式创作和版本控制）（ RFC4918 - 7种、 5842 - 2种）和附加 HTTP 状态码（ RFC6585 - 4种）等扩展，数量就达 **60** 余种。别看种类繁多，实际上经常使用的大概只有 **14** 种。 

## 2XX 成功

* **2XX 的响应结果表明请求被正常处理了**。

### 200 OK

* **表示从客户端发来的请求在服务器端被正常处理了**。在响应报文内， 随状态码一起返回的信息会因方法的不同而发生改变。比如，使用 GET 方法时，对应请求资源的实体会作为响应返回；而使用 HEAD 方法时，对应请求资源的实体首部不随报文主体作为响应返回（**即在响应中只返回首部，不会返回实体的主体部分**）。

### 204 No Content

* **该状态码代表服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分**。 另外，也不允许返回任何实体的主体。比如：当从浏览器发出请求处理后，返回 204 响应，那么浏览器显示的页面不发生更新。**一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用**。

### 206 Partial Content

* 该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的 GET 请求。响应报文中包含由 `Content-Range` 指定范围的实体内容。

## 3XX 重定向

* **3XX 响应结果表明浏览器需要执行某些特殊的处理以正确处理请求**。

### 301 Moved Permanently

* **永久性重定向**。该状态码表示请求的资源已被分配了新的 URI，以后应使用资源现在所指的 URI。也就是说，如果已经把资源对应的 URI保存为书签了，这时应该按 `Location` 首部字段提示的 URI 重新保存。

### 302 Found

* **临时性重定向**。该状态码表示请求的资源已被分配了新的 URI，希望用户（本次）能使用新的 URI 访问。**和 301 Moved Permanently 状态码相似，但 302 状态码代表的资源不是被永久移动， 只是临时性质的**。换句话说，已移动的资源对应的URI 将来还有可能发生改变。比如：用户把 URI 保存成书签，但不会像301 状态码出现时那样去更新书签，而是仍旧保留返回 302 状态码的页面对应的 URI。

### 303 See Other

* **该状态码表示由于请求对应的资源存在着另一个 URI，应使用 GET方法定向获取请求的资源**。303 See Other 状态码和 302 Found 状态码有着相同的功能，但 303 See Other 状态码明确表示客户端应当采用 GET 方法获取资源，这点与 302 状态码有区别。比如，当使用 POST 方法访问 CGI 程序，其执行后的处理结果是希望客户端能以 GET 方法重定向到另一个 URI 上去时，返回 303 See Other 状态码。虽然 302 Found 状态码也可以实现相同的功能，但这里使用 303 状态码是最理想的。

> **NOTE**: 当 301、302、303 响应状态码返回时，几乎所有的浏览器都会把 POST 改成 GET，并删除请求报文内的主体，之后请求会自动再次发送。301、302 标准是禁止将 POST 方法改变成 GET 方法的，但实际使用时大家都会这么做。

### 304 Not Modified

* 该状态码表示客户端发送**附带条件**的请求时，服务器端允许请求访问资源，但未满足条件的情况。**304 Not Modified 状态码返回时，不包含任何响应的主体部分。304 Not Modified 虽然被划分在 3XX 类别中，但是和重定向没有关系**。
> **NOTE**：上述中的附带条件的请求是指采用GET方法的请求报文中包含`If-Match`， `If-ModifiedSince`， `If-None-Match`， `If-Range`， `If-Unmodified-Since`中任一首部。


### 307 Temporary Redirect

* **临时重定向**。该状态码与 302 Found 有着相同的含义。尽管 302 标准禁止 POST 变换成 GET，但实际使用时大家并不遵守。**307 会遵照浏览器标准，不会从 POST 变成 GET。但是，对于处理响应时的行为，每种浏览器有可能出现不同的情况**。

## 4XX 客户端错误

* **4XX 的响应结果表明客户端是发生错误的原因所在**。

### 400 Bad Request

* **该状态码表示请求报文中存在语法错误**。当错误发生时，需修改请求的内容后再次发送请求。另外，浏览器会像 200 OK 一样对待该状态码。

### 401 Unauthorized

* **该状态码表示发送的请求需要有通过 HTTP 认证（ BASIC 认证、DIGEST 认证）的认证信息**。 另外若之前已进行过 1 次请求，则表示用户认证失败。返回含有 401 的响应必须包含一个适用于被请求资源的 `WWW-Authenticate` 首部用以质询（ challenge）用户信息。**当浏览器初次接收到 401 响应，会弹出认证用的对话窗口**。

### 403 Forbidden

* **该状态码表明对请求资源的访问被服务器拒绝了**。服务器端没有必要给出拒绝的详细理由， 但如果想作说明的话，可以在实体的主体部分对原因进行描述，这样就能让用户看到了。**未获得文件系统的访问授权，访问权限出现某些问题（从未授权的发送源 IP 地址试图访问）等列举的情况都可能是发生 403 的原因**。

### 404 Not Found

* **该状态码表明服务器上无法找到请求的资源。除此之外，也可以在服务器端拒绝请求且不想说明理由时使用**。

## 5XX 服务器端错误

* **5XX 的响应结果表明服务器本身发生错误**。

### 500 Internal Server Error

* **该状态码表明服务器端在执行请求时发生了错误**。也有可能是 Web 应用存在的 bug 或某些临时的故障。

### 503 Service Unavailable

* **该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求**。 如果事先得知解除以上状况需要的时间，最好写入 `Retry-After` 首部字段再返回给客户端。

## RFC 2616 中的40种 HTTP 状态码

**40种 HTTP 状态码**：
| 状态码 | 原因短语                                    | 说明                                                                                                                                                                                                                                                                                                       |       备注       |
| :----- | :------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------: |
| 1XX    | Informational（信息性状态码）               |
| 100    | Continue（继续）                            | 说明收到了请求的初始部分， 请客户端继续。 发送了这个状态码之后， 服务器在收到请求之后必须进行响应。                                                                                                                                                                                                        |
| 101    | Switching Protocols（交换协议）             | 说明服务器正在根据客户端的指定， 将协议切换成 Update 首部所列的协议                                                                                                                                                                                                                                        |
| 2XX    | Success（成功状态码）                       |
| 200    | OK                                          | 请求没问题， 实体的主体部分包含了所请求的资源（HEAD 方法中并不会有实体主体）                                                                                                                                                                                                                               | **常用的状态码** |
| 201    | Create（创建）                              | 用于创建服务器对象的请求（ 比如， PUT）。 响应的实体主体部分中应该包含各种引用了已创建的资源的 URL， Location 首部包含的则是最具体的引用。<br />**服务器必须在发送这个状态码之前创建好对象**                                                                                                               |
| 202    | Accepted（接受）                            | **请求已被接受， 但服务器还未对其执行任何动作**。不能保证服务器会完成这个请求；这只是意味着接受请求时，它看起来是有效的。<br />服务器应该在实体的主体部分包含对请求状态的描述，或许还应该有对请求完成时间的估计（或者包含一个指针，指向可以获取此信息的位置）                                              |
| 203    | Non-Authoritative Information（非授权信息） | **实体首部包含的信息不是来自于源端服务器，而是来自资源的一份副本**。 如果中间节点上有一份资源副本，**但无法或者没有对它所发送的与资源有关的元信息（首部）进行验证**，就会出现这种情况。<br />这种响应码并不是非用不可的；如果实体首部来自源端服务器，响应为 200 状态的应用程序就可以将其作为一种可选项使用 |
| 204    | No Content（无内容）                        | **响应报文中包含若干首部和一个状态行， 但没有实体的主体部分**。 主要用于在浏览器不转为显示新文档的情况下， 对其进行更新（比如刷新一个表单页面）                                                                                                                                                            | **常用的状态码** |
| 205    | Reset Content（Reset Content）              | 另一个主要用于浏览器的代码。负责告知浏览器清除当前页面中的所 有 HTML 表单元素                                                                                                                                                                                                                              |
| 206    | Partial Content（部分内容）                 | **成功执行了一个部分或 Range（范围）请求**。客户端可以通过一些特殊的首部来获取部分或某个范围内的文档——这个状态码就说明范围请求成功了。206 响应中必须包含 `Content-Range`、 `Date` 以及 `ETag` 或 `ContentLocation` 首部                                                                                    | **常用的状态码** |
| 207    | Multi-Status（多状态）                      | -                                                                                                                                                                                                                                                                                                          |   **RFC 4918**   |
| 208    | Already Reported（已报告）                  | -                                                                                                                                                                                                                                                                                                          |   **RFC 5842**   |
| 3XX    | Redirection（重定向状态码）                 |3XX 响应结果表明浏览器需要执行某些特殊的处理以正确处理请求
| 300    | Multiple Choices（多种选择）                            |**客户端请求一个实际指向多个资源的 URL 时会返回这个状态码**，比如服务器上有某个 HTML 文档的英语和法语版本。 返回这个代码时会带有一个选项列表； 这样用户就可以选择他希望使用的那一项了。有多个版本可用时，客户端需要沟通解决。服务器可以在 `Location` 首部包含首选 URL
| 301    | Moved Permanently（永久性重定向）                           |**在请求的 URL 已被移除时使用**。 响应的 `Location` 首部中应该包含资源现在所处的 URL -                                                                                                                                                                                                                                                                                                          | **常用的状态码** |
| 302    | Found（临时性重定向）                                       | 与 301 状态码类似；但是，客户端应该使用 `Location` 首部给出的 URL 来临时定位资源。将来的请求仍应使用老的 URL-                                                                                                                                                                                                                                                                                                          | **常用的状态码** |
| 303    | See Other（查看其他位置）                                   | **告知客户端应该用另一个 URL 来获取资源。 新的 URL 位于响应报文的 Location 首部。其主要目的是允许 POST 请求的响应将客户端定向到某个资源上去**-                                                                                                                                                                                                                                                                                                          | **常用的状态码** |
| 304    | Not Modified（未修改）                                | **客户端可以通过所包含的请求首部， 使其请求变成有条件的**。 如果客户端发起了一个条件 GET 请求， 而最近资源未被修改的话，就可以用这个状态码来说明资源未被修改。 **带有这个状态码的响应不应该包含实体的主体部分**-                                                                                                                                                                                                                                                                                                          | **常用的状态码** |
| 305    | Use Proxy（使用代理）                                   |**用来说明必须通过一个代理来访问资源**；代理的位置由 `Location` 首部给出。很重要的一点是，客户端是相对某个特定资源来解析这条响应的，不能假定所有请求，甚至所有对持有所请求资源的服务器的请求都通过这个代理进行。**如果客户端错误地让代理介入了某条请求，可能会引发破坏性的行为， 而且会造成安全漏洞**
| 306    | (Unused - 未使用)                                    |当前未使用
| 307    | Temporary Redirect（临时重定向）                          | 与 301 状态码类似； 但客户端应该使用 `Location` 首部给出的 URL 来临时定位资源。将来的请求应该使用老的 URL-                                                                                                                                                                                                                                                                                                          | **常用的状态码** |
| 4XX    | Client Error（客户端错误状态）              |4XX 的响应结果表明客户端是发生错误的原因所在
| 400    | Bad Request（错误请求）                                 |用于告知客户端它发送了一个错误的请求|**常用的状态码**
| 401    | Unauthorized（未经过认证的）                                |**与适当的首部一同返回，在这些首部中请求客户端在获取对资源的访问权之前，对自己进行认证**。 |**常用的状态码**
| 402    | Payment Required（必须完整）                            |**现在这个状态码还未使用， 但已经被保留， 以作未来之用**
| 403    | Forbidden（禁止访问）                                   |**用于说明请求被服务器拒绝了**。如果服务器想说明为什么拒绝请求，可以包含实体的主体部分来对原因进行描述。**但这个状态码通常是在服务器不想说明拒绝原因的时候使用的**|**常用的状态码**
| 404    | Not Found（没有找到）                                   |**用于说明服务器无法找到所请求的 URL**。通常会包含一个实体，以便客户端应用程序显示给用户看|**常用的状态码**
| 405    | Method Not Allowed（方法不被允许）                          |**发起的请求中带有所请求的 URL 不支持的方法时，使用此状态码**。应该在响应中包含 Allow 首部，以告知客户端对所请求的资源可以使用哪些方法。
| 406    | Not Acceptable（不接受）                              |**客户端可以指定参数来说明它们愿意接收什么类型的实体**。服务器没有与客户端可接受的 URL 相匹配的资源时，使用此代码。通常，**服务器会包含一些首部，以便客户端弄清楚为什么请求无法满足**。
| 407    | Proxy Authentication（代理认证）                        |**与 401 状态码类似，但用于要求对资源进行认证的代理服务器**
| 408    | Request Timeout（请求超时）                             |**如果客户端完成请求所花的时间太长，服务器可以回送此状态码，并关闭连接**。超时时长随服务器的不同有所不同，但通常对所有的合法请求来说，都是够长的
| 409    | Conflict（请求冲突）                                    |**用于说明请求可能在资源上引发的一些冲突**。服务器担心请求会引发冲突时，可以发送此状态码。响应中应该包含描述冲突的主体
| 410    | Gone（不复存在）                                        |**与 404 类似，只是服务器曾经拥有过此资源**。主要用于 Web 站点的维护，这样服务器的管理者就可以在资源被移除的情况下通知客户端了
| 411    | Length Required（要求长度）                             |**服务器要求在请求报文中包含 `Content-Length` 首部时使用**。
| 412    | Precondition Failed（前提条件失败）                         |**客户端发起了条件请求，且其中一个条件失败了的时候使用**。客户端包含了 `Expect` 首部时发起的就是条件请求。
| 413    | Request Entity Too Large（请求实体太大）                    |客户端发送的实体主体部分比服务器能够或者希望处理的要大时，使用此状态码
| 414    | Request-URI Too Long（请求 URI 太长）                        |客户端所发请求中的请求 URL 比服务器能够或者希望处理的要长时，使用此状态码
| 415    | Unsupported Media Type（不支持的媒体类型）                      |服务器无法理解或无法支持客户端所发实体的内容类型时，使用此状态码
| 416    | Requested Range Not Satisfiable（请求范围不符合）             |请求报文所请求的是指定资源的某个范围，而此范围无效或无法满足时，使用此状态码
| 417    | Expectation Failed（预期失败）                          |请求的 `Expect` 请求首部包含了一个期望，但服务器无法满足此期望时，使用此状态码。如果代理或其他间应用程序有确切证据说明源端服务器会为某请求产生一个失败的期望，就可以发送这个响应状态码
| 422    | Unprocessable Entity                        | -                                                                                                                                                                                                                                                                                                          |   **RFC 4918**   |
| 423    | Locked                                      | -                                                                                                                                                                                                                                                                                                          |   **RFC 4918**   |
| 424    | Failed Dependency                           | -                                                                                                                                                                                                                                                                                                          |   **RFC 4918**   |
| 428    | Precondition Required                       | -                                                                                                                                                                                                                                                                                                          |   **RFC 6585**   |
| 429    | Too Many Requests                           | -                                                                                                                                                                                                                                                                                                          |   **RFC 6585**   |
| 431    | Request Header Fields Too Large             | -                                                                                                                                                                                                                                                                                                          |   **RFC 6585**   |
| 5XX    | Server Error（服务器错误状态码）            |5XX 的响应结果表明服务器本身发生错误
| 500    | Internal Server Error（内部服务器错误）                       |服务器遇到一个妨碍它为请求提供服务的错误时，使用此状态码|**常用的状态码**|
| 501    | Not Implemented（不可执行）                             |客户端发起的请求超出服务器的能力范围（比如，使用了服务器不支持的请求方法）时，使用此状态码
| 502    | Bad Gateway（网关错误）                                 |作为代理或网关使用的服务器从请求响应链的下一条链路上收到了一条伪响应（比如，它无法连接到其父网关） 时，使用此状态码
| 503    | Service Unavailable（找不到服务器）                         |用来说明服务器现在无法为请求提供服务，但将来可以。如果服务器知道什么时候资源会变为可用的，可以在响应中包含一个 `Retry-After` 首部。|**常用的状态码**|
| 504    | Gateway Timeout（网关超时）                             |与状态码 408 Request Timeout 状态码类似，只是这里的响应来自一个网关或代理，它们在等待另一服务器对其请求进行响应时超时了
| 505    | HTTP Version Not Supported（不支持的HTTP版本）                  |服务器收到的请求使用了它无法或不愿支持的协议版本时，使用此状态码。有些服务器应用程序会选择不支持协议的早期版本
| 507    | Insufficient Storage                        | -                                                                                                                                                                                                                                                                                                          |   **RFC 4918**   |
| 508    | Loop Detected                               | -                                                                                                                                                                                                                                                                                                          |   **RFC 5842**   |
| 511    | Network Authentication Required             | -                                                                                                                                                                                                                                                                                                          |   **RFC 5842**   |

*表格中的中文内容来自于 《HTTP 权威指南》，表格中没有标注 RFC 版本的就是我们日常使用 RFC 2616*

## 扩展阅读

* [RFC 2616](https://tools.ietf.org/html/rfc2616)
* 《HTTP 权威指南》p62~p70
* [RFC 4918](https://tools.ietf.org/html/rfc4918)
* [RFC 5842](https://tools.ietf.org/html/rfc5842)
* [RFC 6585](https://tools.ietf.org/html/rfc6585)

## TODO